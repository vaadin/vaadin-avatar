<!--
@license
Copyright (c) 2020 Vaadin Ltd.
This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
-->

<link rel="import" href="../../polymer/polymer-element.html">
<link rel="import" href="../../vaadin-themable-mixin/vaadin-themable-mixin.html">
<link rel="import" href="../../vaadin-element-mixin/vaadin-element-mixin.html">
<link rel="import" href="vaadin-avatar-icons.html">

<dom-module id="vaadin-avatar">
  <template>
    <style>
      :host {
        display: inline-block;
        border-radius: 50%;
        overflow: hidden;
        height: 44px;
        width: 44px;
      }

      img {
        height: 100%;
        width: 100%;
      }

      svg {
        font-size: 5.6em;
      }

      svg#avatar-icon > text::before {
        font-family: 'vaadin-avatar-icons';
      }

      :host([hidden]) {
        display: none !important;
      }

      svg[hidden] {
        display: none !important;
      }
    </style>
    <img hidden$="[[!__imgVisible]]" src$="[[img]]" />
    <svg hidden$="[[__imgVisible]]" id="avatar-icon" viewBox="-50 -50 100 100" preserveAspectRatio="xMidYMid meet">
      <text dy=".35em" text-anchor="middle">&#xea01;</text>
    </svg>
  </template>

  <script>
    (function() {

      /**
       * `<vaadin-avatar>` is a Web Component providing avatar displaying functionality.
       *
       * ```html
       * <vaadin-avatar img="avatars/avatar-1.jpg"></vaadin-avatar>
       * ```
       *
       * @memberof Vaadin
       * @mixes Vaadin.ElementMixin
       * @mixes Vaadin.ThemableMixin
       * @demo demo/index.html
       */
      class VaadinAvatar extends Vaadin.ElementMixin(Vaadin.ThemableMixin(Polymer.Element)) {
        static get is() {
          return 'vaadin-avatar';
        }
        static get version() {
          return '0.1.0';
        }

        static get properties() {
          return {
            /**
             * The path to the image
             */
            img: {
              type: String,
              reflectToAttribute: true,
              observer: '__imgChanged'
            },

            /** @private */
            __imgVisible: Boolean
          };
        }

        ready() {
          super.ready();

          this.__updateVisibility();
        }

        __imgChanged(img) {
          this.__updateVisibility();
        }

        __updateVisibility() {
          this.__imgVisible = !!this.img;
        }

        __computeImgVisible(img) {
          return !!img;
        }
      }

      customElements.define(VaadinAvatar.is, VaadinAvatar);

      /**
       * @namespace Vaadin
       */
      window.Vaadin.VaadinAvatar = VaadinAvatar;
    })();
  </script>
</dom-module>
